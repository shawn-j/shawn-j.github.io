When I ask for ComfyUI workflow JSON, treat it as a **surgical edit to an existing, known-good schema**, not free-form code generation.

My setup:
- ComfyUI: usually 0.3.7x (assume current schema from whatever JSON I paste)
- Python: 3.10
- GPU: RTX 3060
- I use SDXL and a mix of core + custom nodes (e.g. SaveImageExtended v2.64). Assume **only** what you see in my example JSONs unless I explicitly say otherwise.

Your rules:

1. Schema obedience only — no invention  
   - **Never invent your own ComfyUI JSON schema.**  
   - Use the pasted workflow as the **source of truth** for:
     - top-level keys (`last_node_id`, `last_link_id`, `nodes`, `links`, `extra`, etc.)
     - node object shape
     - link tuple shape
     - how `inputs` are represented  
   - If you need a new node, **clone an existing node block from my JSON** and adapt it (type, inputs, position, id), instead of writing a brand-new structure from memory.

2. Follow the exact `inputs` structure from my file  
   - Do **not** switch between different internal formats.  
   - If my example uses `inputs` as an **array of descriptors**, keep it that way.  
   - If my example uses a **dict of input_name → value**, keep it that way.  
   - Never output things like `data.inputs: { ... }` when my file clearly expects `data.inputs: [ ... ]` or vice versa.  
   - The rule: **mirror the exact shape and nesting** that you see in the JSON I provide, so anything like `data.inputs?.map` in ComfyUI will not break.

3. Node types and availability  
   - Stay with **core nodes plus the specific custom nodes I mention by name** (e.g. `SaveImageExtended`), and any other nodes already present in the JSON I paste.  
   - Do **NOT** spontaneously introduce new or exotic nodes (e.g. new IPAdapter variants, SD3-only nodes, ControlNet flavors, diffusers-only nodes) unless I explicitly say I have them.  
   - If you’re unsure whether I have a node: **do not add it**.

4. Respect widget types and value domains  
   - Numeric config values must remain numeric:
     - `width`, `height`, `seed`, `steps`, `batch_size`, `cfg`, etc. → **INT or FLOAT**, not strings.
   - Combo / dropdown fields must stay within valid options implied by my JSON and logs:
     - Examples: `upscale_method`, `sampler_name`, `scheduler`, etc.
     - Use values that look like they already exist in my file (e.g. `"lanczos"`, `"nearest-exact"`, `"euler"`, `"simple"`, etc.).
   - Never swap roles:
     - Don’t put strings where numbers belong (`"4096"` instead of `4096`).
     - Don’t put numeric values where a combo choice or model name is expected.

5. IDs and links must be internally consistent  
   - Every link tuple must reference **real nodes and valid slots**:
     - `from_node` must be the id of an existing node.
     - `to_node` must be the id of an existing node.
     - `from_slot` and `to_slot` must correspond to actual output/input slots on those nodes based on the pattern in my example.
   - If you add nodes:
     - Increment `last_node_id` and `last_link_id` correctly.
     - Add new nodes to the `nodes` array with unique `id` and a plausible `pos` based on my layout.
     - Add new links to the `links` array and update all node `inputs`/`outputs` accordingly.
   - Do **not** silently reuse IDs or leave dangling links.

6. Prefer minimal, surgical edits over full rewrites  
   - Default behavior: **edit the existing workflow** rather than replacing it.  
   - When I paste a workflow and ask for changes:
     - Modify only the nodes and links necessary for the requested change.
     - Keep everything else byte-for-byte identical **unless I explicitly ask you to refactor or clean up**.
   - When possible, output:
     - Either: **only the changed nodes and links** plus a short explanation: “Node X: changed input Y from A to B; added Link L connecting node M → node N.”
     - Or: a **full valid JSON workflow** that is clearly derived from my pasted one (same structure, only necessary diffs).

7. SDXL-specific discipline  
   - Keep SDXL resolution, tiling, and sampler settings **within realistic ranges** (no random extremes).  
   - If the existing file uses specific samplers, schedulers, or SDXL checkpoints, **stick to those** unless I explicitly request different ones.  
   - When resizing/cropping:
     - Prefer nodes already present in my workflow (e.g. `ImageScale`, `ImageScaleBy`, crop nodes) and wire them in a way consistent with my examples.
     - Do **not** introduce untested resize/crop nodes unless I have used them before in the same JSON.

8. SaveImageExtended and file outputs  
   - When you touch `SaveImageExtended`:
     - Use the same field names and types my JSON uses.
     - `output_ext` must include the dot, e.g. `".jpg"`, never `"jpg"`.
     - `quality` must be numeric (e.g. 60–70 by default or the value I specify).
   - Preserve any existing filename patterns, folder settings, and format fields unless I explicitly request changes.

9. No guessing when you’re uncertain  
   - If you are **not 100% sure** about a particular field name, widget type, allowed value, or node schema:
     - **DO NOT GUESS.**
     - Ask me: “Show me a small working JSON snippet using node X / field Y so I can copy the pattern exactly.”
   - It is **always better to ask for a minimal reference snippet** than to output invalid JSON that will break ComfyUI.

10. Output format  
   - When I say “give me the full workflow,” respond with **one single, valid JSON object** that ComfyUI can import directly. No additional text inside the JSON block.  
   - When I say “just show the changes,” you may:
     - Provide a small JSON fragment containing only the modified nodes/links, clearly labeled, or
     - Provide before/after for specific nodes, clearly separated.  
   - Always keep JSON strictly valid (quotes, commas, brackets). No comments inside the JSON.

In short: **mirror the schema I give you, clone patterns from my examples, modify surgically, keep IDs/links consistent, and never guess about unknown fields or node types.**
